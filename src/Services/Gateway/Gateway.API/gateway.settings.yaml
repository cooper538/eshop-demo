# yaml-language-server: $schema=./Configuration/gateway.settings.schema.json
# Gateway Service Configuration
# Environment-specific overrides: gateway.settings.{Environment}.yaml

AllowedHosts: "*"

Logging:
  LogLevel:
    Default: "Information"
    Microsoft.AspNetCore: "Warning"
    Yarp: "Information"

Gateway:
  Service:
    Name: "Gateway"

  RateLimiting:
    Enabled: true
    PermitLimit: 100
    WindowSeconds: 60
    QueueLimit: 0

  OutputCache:
    ProductsListCacheMinutes: 5
    ProductDetailCacheMinutes: 2
    SwaggerCacheMinutes: 1440  # 24h

ReverseProxy:
  Routes:
    # Swagger/OpenAPI routes (cached 24h)
    products-swagger-route:
      ClusterId: "product-cluster"
      OutputCachePolicy: "SwaggerCache"
      Match:
        Path: "/api/products/swagger/{**catch-all}"

    orders-swagger-route:
      ClusterId: "order-cluster"
      OutputCachePolicy: "SwaggerCache"
      Match:
        Path: "/api/orders/swagger/{**catch-all}"

    # GET /api/products - cached 5 min
    products-list-route:
      ClusterId: "product-cluster"
      RateLimiterPolicy: "fixed"
      OutputCachePolicy: "ProductsCache"
      Match:
        Path: "/api/products"
        Methods: ["GET"]

    # GET /api/products/{id} - cached 2 min
    products-detail-route:
      ClusterId: "product-cluster"
      RateLimiterPolicy: "fixed"
      OutputCachePolicy: "ProductDetailCache"
      Match:
        Path: "/api/products/{**catch-all}"
        Methods: ["GET"]

    # POST/PUT/DELETE /api/products - no cache
    products-write-route:
      ClusterId: "product-cluster"
      RateLimiterPolicy: "fixed"
      Match:
        Path: "/api/products/{**catch-all}"
        Methods: ["POST", "PUT", "DELETE"]

    orders-route:
      ClusterId: "order-cluster"
      RateLimiterPolicy: "fixed"
      Match:
        Path: "/api/orders/{**catch-all}"

  Clusters:
    product-cluster:
      Destinations:
        product-service:
          Address: "http://product-service"

    order-cluster:
      Destinations:
        order-service:
          Address: "http://order-service"
